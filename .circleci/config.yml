version: 2.1

executors:
  node:
    docker:
      - image: cimg/node:20.17
    working_directory: ~/repo

jobs:
  # echoã§ãƒ­ã‚°å‡ºã™ã ã‘w
  build:
    executor: node
    steps:
      - checkout
      - run:
          name: Show build log
          command: echo "âœ… Hello from CircleCI - Next.js Project!"

  # gitã‚’æ§‹ç¯‰ã—ã¦ã€ã‚¿ã‚°ã‚’ä½œæˆã—ã¦ã¿ã‚ˆã†
  tag:
    executor: node
    steps:
      - checkout
      - run:
          name: Install git
          command: |
            sudo apt-get update && sudo apt-get install -y git
      - run:
          name: Configure Git
          command: |
            git config user.email "ci-bot@example.com"
            git config user.name "CircleCI Bot"
      - run:
          name: Create and Push Tag
          command: |
            DATE=$(date +'%Y%m%d')
            TAG_NAME="next-${DATE}"
            echo "ğŸ“Œ Creating tag: ${TAG_NAME}"
            git tag "${TAG_NAME}"
            git push https://${GH_TOKEN}@github.com/${CIRCLE_PROJECT_USERNAME}/${CIRCLE_PROJECT_REPONAME}.git "${TAG_NAME}"

workflows:
  version: 2
  build_and_tag:
    jobs:
      - build
      - tag:
          # buildã®æˆåŠŸãŒå¿…é ˆ
          requires:
            - build
